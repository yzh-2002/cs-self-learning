## Router

传统网络路由器分为`路由控制平面（软件支持）`和`转发数据平面（硬件支持）`

`路由控制平面`运行路由选择算法（RIP,OSPF,BGP）等生成路由表。一般是运行一个`Router Processor`

`转发数据平面`从输入到输出链路交换数据报-根据路由表进行分组的转发。包括输入链路，高速交换结构，输出链路

### 输入链路

输入链路又可分为`line termination（物理层，Bit级接收）`，`link layer protocol(receive)（数据链路层，动作？解封装？）`和分布式交换

分布式交换做什么事情呢？

根据数据报头部的信息如：目的地址，在`输入端口内存中的转发表`（实际可能是在交换结构中进行查表匹配而不是输入端口，**此处资料不是很明确**）中查找合适的输出端口（匹配+行动）。传统网络是基于目的IP进行匹配转发，SDN则可以根据数据包头部任意字段进行匹配转发。

#### 最长前缀匹配

如何根据目的IP进行匹配转发呢？ --最长前缀匹配

#### 输入链路缓存

当交换机构的速率小于输入端口的汇聚速率时， 在输入端口可能要排队，而排队延迟以及由于输入缓存溢出会造成丢失!

`HOL BLOCKING`：由于队头的数据包因为某些原因（路由表查询等）造成延迟，使得后续的数据包只能等待，无法转发的现象。

解决办法：队列管理算法，拥塞控制（及时丢弃一些队头数据包），快速转发（优化软硬件，加快计算速度等等）等等。

缓存内的分组调度（`决定哪个分组要通过链路传输`）机制：
1. FIFO
2. 优先级（多个优先级队列）
3. 多类（优先发送同一组数据包）
4. `等待时间`决定优先级


### 高速交换结构
> 将数据包从输入端口缓存区传输到合适的输出端口，理想情况下，N个输入端口，那么交换速率应该是输入速率的N倍。

1. 内存交换
    1. 在CPU控制下进行交换，先将分组拷贝到内存，在根据头部目的IP查询转发表，再转发到输出端口
    2. 转发速率主要在于内存的处理速率（同时需要经过两次BUS总线）
    3. 一次只能处理一个数据包
2. 总线交换
    1. 数据包通过共享总线，从输入到输出
    2. 转发速率受限于总线速率
    3. 一次只能处理一个数据包
3. 互联网络交换
