## 网络应用体系结构

1. 客户-服务器模式
2. 对等模式（`P2P Peer to Peer`）
3. 混合模式

### CS模式

1. 服务器一直运行，固定的IP和周知的端口号（约定）
2. 客户端主动连接，具有动态的IP，不能与其他客户端通信

### P2P模式

1. 任意端系统之间可以通信，每一个端系统既是客户端又是服务端
2. 参与的主机间歇性连接，且可以改变IP

应用：文件分发（BitTorrent）...

下面从文件分发场景入手，对比p2p模式较之cs模式的优势：从一台服务器分发文件（大小为F）到N个peer,需要多久？（假设服务器上传速率为$u_{s}$）

cs模式下，每个peer的文件均从服务器上传，时间为：$NF/U_{s}$。

p2p模式下，服务端最少只需要上传一份，由于客户端可以从其他节点获取文件，故上载总带宽为：$u_{s}+\sum{u_{i}}$，可得时间为：$min(F/u_{s}, NF/(u_{s}+\sum{u_{i}}))$

#### 文件分发

文件分发场景中有两个关键词：`tracker`和`torrent`：
1. Tracker（追踪器）：Tracker是一个服务器，用于管理和协调P2P网络中的文件共享。它维护一个记录所有参与者（也称为"peers"）的列表，这些参与者正在共享或下载特定文件。当一个用户加入P2P网络时，它向Tracker注册，并获取其他用户（peers）的信息，从而能够建立直接的点对点连接来下载或上传文件。
2. Torrent（种子）：Torrent是一个包含文件或目录的元数据文件。它包含了文件的名称、大小、哈希值和Tracker的信息。种子文件通常使用.torrent扩展名，并由Torrent客户端使用来连接Tracker并获取其他用户的信息。

### 混合模式

1. Napster
    1. 文件搜索：主机向中心服务器注册资源并检索
    2. 文件传输：任意主机之间
2. 即时通信
    1. 在线检测：用户上线时，向中心服务器注册IP，与用户聊天时向中心服务器搜寻好友IP
    2. 用户聊天

## 网络应用通信原理
> 网络应用之间的通信本质上是两个主机之间的进程通信

根据网络协议分层原理可知：网络应用之间的通信需要依赖于下一层传输层提供的服务（被抽象为`Socket API`），传输层提供的服务要求上层应用指明以下信息：

1. 传输报文（应用层报文，传输层会对其进行封装得到传输层报文）
2. 传输源和目的标识（`IP+Port`）

对于每次Socket通信而言，携带传输源和目的标识有些繁琐且容易出错，故`Socket API`提供了一个代号(`Socket`)标识`IP+Port`（就像Linux文件操作中的fd）。

对于基于TCP服务的应用通信，由于需要实现建立连接，因此采用(`SRC IP, SRC Port, DST IP, DST Port`)这个四元组对应一个`Socket`，发送报文时只需要携带该`Socket`+应用层报文即可

对于基于UDP服务的应用通信，由于无需建立连接，因此只需要对本地`(IP, Port)`对应一个`Sokcet`即可，但是发送报文时需要携带`(DST IP, DST Port)`

上面讲述了应用层如何使用传输层提供的服务进行数据通信，而应用层协议是定义了不同主机上应用如何解析报文，以及拿到解析后报文信息应该做什么动作。


