## 可靠数据传输原理
> rdt(reliable data transfer)

1. 可靠信道如何保证传输可靠？
2. 具有`bit差错`的信道如何保证传输可靠？
    1. 校验和：判断数据包是否有差错
    2. 有差错怎么办？接收方发送`ACK n`（n为上一个未出错的数据包序号），发送方根据序号判断是否重传
3. 具有`bit差错`且`分组丢失`的信道如何保证可靠传输？
    1. 数据包丢失（特别是`ACK`丢失怎么办？），设置一个定时器，超时重传即可

停等协议和流水线？不再赘述。

### 流水线传输
> 流水线：允许发送方在未得到对方确认的情况下一次发送多个分组

需要进行的改造有：

1. 增加序号范围，之前停等协议由于一次只涉及一个数据包，故使用0,1即可，多个数据包则需增加序号
2. 设置缓存区
    1. 接收方要保证数据包顺序上传给应用层，故乱序的数据包需要暂存缓存区。
    2. 接收方可能需要重传数据包。

通用的流水线协议有两种：`回退n步（gbn）`和`选择重传（sr）`

### 滑动窗口协议
> gbn和sr协议的通用之处

所谓滑动窗口，其实就是指发送/接收缓存区的形式。

发送缓存区中的分组：
1. 未发送：可以直接发送
2. 已发送未确认：等待确认（可能需要重传）
3. 已发送且确认的高序数据包（由于低序数据包未确认，故滑动窗口无法前移）

> 为什么不能把高序的直接从窗口移除，保留低序并添加后一个数据包呢？（也即从0,1,2,3=>0,2,3,4）

原因在于接收窗口也采用滑动窗口这一模型，由于接收窗口未接收到低序，不能前移，所以接收窗口此时仍然是（0,1,2,3），如果我们只是单纯的把发送窗口前移，那么4序号的数据包虽然能发送了，但是也只能被丢弃。

接收缓存区中的分组：（目的是用于指示接收方预期接收的数据包）
1. 数据包不在分组内：直接丢弃
2. 数据包在分组内，且低序：接收，并且向前移动接收窗口
3. 数据包在分组内，且高序：接收，不移动窗口直到低序被接收

当接收窗口为1时，接收方只会顺序接收报文，并且返回确认的序号一定是累积接收的数据包序号（`累积确认`），但是发送的多个数据包中低序的未被接收，高序的也需要重新发送（好处就是只需要设置一个定时器）

当接收窗口大于1时，接收方可以乱序接收报文，返回的确认不一定是累积接收的数据包序号，好处就是低序的不被接收只需要选择上传低序数据包即可（但是需要给`每一个发送且未确认`的数据包都设置一个定时器）

GBN和SR的区别：
1. 相同点：发送窗口均大于1
2. 不同点：GBN接收窗口=1,SR接收窗口>1

适用范围：对于出错率低的链路，可以使用GBN，对于链路容量大的可以使用SR


## 拥塞控制原理
> 所谓拥塞，即太多的数据需要传输，超过了网络自身处理能力，多表现为分组丢失（路由器缓存区溢出）和延迟过长（路由器中排队）

拥塞的代价：

1. 拥塞，丢包，导致重传，降低了链路的有效输出
2. 拥塞，延迟增加，数据包可能未丢包但同样因为超时被重传了
3. 拥塞，丢包，上游传输能力为0

拥塞控制方法：

1. 端到端拥塞控制：没有网络显示反馈，根据延迟和丢失时间来判断是否丢包（TCP采用的方法）
2. 网络辅助拥塞控制：路由器提供给端系统反馈信息